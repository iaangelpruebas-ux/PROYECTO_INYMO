doctype html
html(lang="es")
  head
    meta(charset="UTF-8")
    title Reporte #{c.nombre_comercial} | INYMO
    link(href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet")
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet")
    
    style.
      /* ESTILOS IDNTICOS A LA COTIZACIN */
      @page { size: letter; margin: 0; }
      @media print {
        body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; background: white !important; }
        .no-print { display: none !important; }
        .hoja { box-shadow: none !important; margin: 0 !important; width: 100% !important; height: auto !important; }
      }
      body { font-family: 'Inter', sans-serif; margin: 0; padding: 40px 0; color: #1f1f1f; background: #525659; }
      .hoja { width: 216mm; min-height: 279mm; background: white; margin: 0 auto; position: relative; overflow: hidden; display: flex; flex-direction: column; }
      
      /* HEADER NEGRO */
      .brand-section { background-color: #111; padding: 40px 50px 30px 50px; display: flex; justify-content: space-between; border-bottom: 4px solid #67d826ff; color: #fff; }
      .logo-img { max-height: 70px; display: block; margin-bottom: 15px; }
      .company-details { font-size: 0.7rem; color: #adb5bd; line-height: 1.5; border-left: 2px solid #333; padding-left: 15px; }
      .company-details strong { color: #fff; }
      
      .folio-display { text-align: right; }
      .folio-number { font-size: 1.5rem; font-weight: 800; color: #fff; letter-spacing: -0.5px; }
      .folio-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; color: #67d826ff; margin-bottom: 5px; }
      
      /* DATOS CLIENTE */
      .client-section { margin: 30px 50px; padding: 25px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #edf2f4; display: flex; justify-content: space-between; }
      .section-label { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; color: #adb5bd; letter-spacing: 1px; margin-bottom: 8px; }
      .client-name { font-size: 1.2rem; font-weight: 700; color: #000; margin-bottom: 5px; }
      .client-data { font-size: 0.85rem; color: #495057; line-height: 1.6; }

      /* KPIs BOXES */
      .kpi-container { display: flex; gap: 20px; padding: 0 50px; margin-bottom: 20px; }
      .kpi-box { flex: 1; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; text-align: center; }
      .kpi-title { font-size: 0.7rem; text-transform: uppercase; color: #888; font-weight: 600; }
      .kpi-val { font-size: 1.5rem; font-weight: 800; color: #111; margin-top: 5px; }
      .kpi-sub { font-size: 0.75rem; color: #67d826ff; margin-top: 5px; font-weight: 600; }

      /* SECCIN FINANCIERA (NUEVA) */
      .finance-section { padding: 0 50px; margin-bottom: 20px; }
      .finance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
      .finance-card { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 6px; }
      .finance-header { font-size: 0.8rem; font-weight: 700; color: #111; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 5px; }
      .finance-row { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; color: #555; }

      /* TABLAS */
      .table-section { padding: 0 50px; margin-bottom: 30px; }
      table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
      th { text-align: left; padding: 8px; border-bottom: 2px solid #111; font-weight: 700; text-transform: uppercase; font-size: 0.7rem; }
      td { padding: 8px; border-bottom: 1px solid #f1f3f5; }
      .text-right { text-align: right; }
      .badge-print { padding: 2px 6px; border-radius: 4px; font-weight: 600; font-size: 0.65rem; border: 1px solid #ddd; }

      /* FOOTER */
      .footer-section { margin-top: auto; padding-bottom: 0; }
      .legal-bar { background-color: #f8f9fab7; color: #adb5bd; text-align: center; font-size: 0.65rem; padding: 12px 50px; border-top: 1px solid #e9ecef; }

  body
    .no-print(style="position: fixed; top: 20px; right: 20px; z-index: 1000;")
        button(onclick="window.print()" style="background:#111; color:white; border:none; padding:10px 20px; border-radius:30px; cursor:pointer; font-weight:bold;") Imprimir Documento

    .hoja
      //- HEADER ESTILO DARK
      .brand-section
        .company-block
          img.logo-img(src="/images/logo-inymo-white.png" alt="INYMO")
          .company-details
            strong Ingenier铆a y Montajes de Occidente S.A. de C.V.
            br
            | Av. Vallarta 1234, Guadalajara, Jalisco.
            br
            | contacto@inymo.com | (33) 1234-5678

        .folio-display
          .folio-label REPORTE EJECUTIVO
          .folio-number #{c.id.toString().padStart(4, '0')}
          div(style="font-size: 0.8rem; margin-top: 10px; color:#ccc;") #{fechaImpresion.toLocaleDateString('es-MX', {weekday:'long', year:'numeric', month:'long', day:'numeric'})}

      //- RESUMEN CLIENTE
      .client-section
        div(style="width: 60%")
          .section-label PERFIL DEL CLIENTE
          .client-name= c.nombre_comercial
          .client-data
            div RFC: #{c.rfc || 'N/D'}
            div Direcci贸n: #{c.direccion || 'Sin direcci贸n registrada'}
            div Contacto: #{c.contacto} | #{c.correo}
        
        div(style="width: 35%; border-left: 1px solid #eee; padding-left: 20px;")
          .section-label CLASIFICACIN
          .client-data
            div Segmento: <strong>#{segmento}</strong>
            div Estatus: <strong>#{c.activo ? 'Activo' : 'Inactivo'}</strong>
            div Ejecutivo: #{c.ejecutivo_asignado || 'ngel Velasco'}

      //- KPIs DESTACADOS
      .kpi-container
        .kpi-box
          .kpi-title Total Vendido (LTV)
          .kpi-val= "$" + totalVendido.toLocaleString('es-MX', {minimumFractionDigits: 0})
          .kpi-sub MXN Acumulado
        .kpi-box
          .kpi-title Cotizaciones Ganadas
          .kpi-val= ventas.length
          .kpi-sub Proyectos Cerrados
        .kpi-box
          .kpi-title Nivel Satisfacci贸n
          .kpi-val #{c.satisfaccion_cliente || 5}/10
          .kpi-sub Voz del Cliente (VOC)

      //- SECCIN FINANCIERA DETALLADA
      .finance-section
        .finance-grid
            .finance-card
                .finance-header Resumen de Cr茅dito
                .finance-row
                    span L铆mite de Cr茅dito:
                    strong= "$" + parseFloat(c.credito_asignado).toLocaleString('es-MX')
                .finance-row
                    span Uso Actual (Estimado):
                    span $0.00
                .finance-row
                    span Disponible:
                    strong(style="color: #67d826ff")= "$" + parseFloat(c.credito_asignado).toLocaleString('es-MX')
            
            .finance-card
                .finance-header Operaciones en Curso
                .finance-row
                    span Cotizaciones Abiertas:
                    strong= abiertas.total || 0
                .finance-row
                    span Monto en Juego:
                    strong= "$" + parseFloat(abiertas.monto || 0).toLocaleString('es-MX')
                .finance-row
                    span Condiciones Comerciales:
                    span 30 d铆as cr茅dito / Sin descuentos

      //- TABLA INCIDENCIAS
      .table-section
        .section-label(style="margin-bottom: 10px;") LTIMAS INCIDENCIAS FINANCIERAS
        table
            thead
                tr
                    th Fecha
                    th Tipo
                    th Descripci贸n
                    th Monto
                    th Estatus
            tbody
                each inc in incidencias
                    tr
                        td= new Date(inc.fecha_reporte).toLocaleDateString()
                        td= inc.tipo
                        td= inc.descripcion
                        td= "$" + parseFloat(inc.monto_involucrado).toLocaleString('es-MX')
                        td= inc.estatus
                if incidencias.length == 0
                    tr: td(colspan="5" style="text-align:center; color:#999; padding:15px;") Historial limpio. Sin incidencias.

      //- TABLA ESTRUCTURA DOCUMENTAL
      .table-section
        .section-label(style="margin-bottom: 10px;") CARPETAS DIGITALES ACTIVAS
        if carpetas.length > 0
            div(style="display: flex; flex-wrap: wrap; gap: 10px;")
                each carp in carpetas
                    div(style="padding: 5px 15px; background: #f8f9fa; border: 1px solid #eee; border-radius: 20px; font-size: 0.75rem;")  #{carp.nombre}
        else
            div(style="color:#999; font-size: 0.75rem;") No hay carpetas creadas.

      //- TABLA DE VENTAS RECIENTES
      .table-section
        .section-label(style="margin-bottom: 15px;") LTIMAS OPERACIONES CERRADAS (TOP 15)
        table
          thead
            tr
              th Fecha
              th Folio Cotizaci贸n
              th Estatus
              th.text-right Importe
          tbody
            each v in ventas
              tr
                td= new Date(v.fecha_creacion).toLocaleDateString()
                td <strong>#{v.folio}</strong>
                td(style="color: #67d826ff; font-weight: bold;") Aceptada
                td.text-right= "$" + parseFloat(v.monto_total).toLocaleString('es-MX', {minimumFractionDigits: 2})
            if ventas.length == 0
                tr: td(colspan="4" style="text-align:center; padding: 30px; color:#999;") No hay ventas registradas.

      //- FOOTER
      .footer-section
        .legal-bar
          div REPORTE CONFIDENCIAL GENERADO POR PLATAFORMA INYMO
          div Documento informativo de uso interno. Fecha de generaci贸n: #{new Date().toLocaleString()}
doctype html
html
  head
    title INYMO | Innovando
    link(rel='icon', href='/images/icono.png', type='image/png')
    link(rel='stylesheet', href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap')
    link(rel='stylesheet', href='/stylesheets/base.css')
    link(rel='stylesheet', href='/stylesheets/intro.css')
  
  body.intro-body
    
    // A. VIDEO DE FONDO (Muted para que NUNCA se trabe)
    div.video-background
      video#introVideo(autoplay muted playsinline)
        source(src="/videos/Intro_video.mp4" type="video/mp4")
    
    // B. AUDIO INDEPENDIENTE
    audio#introAudio(preload="auto")
      source(src="/videos/Musica-intro.mp3" type="audio/mpeg")

    div.overlay

    div.intro-content
      img.intro-logo(src="/images/logo-inymo-white.png" alt="INYMO Logo")
      h1 INNOVANDO EN LA INGENIERÍA
      p.subtitle Solidez • Precisión • Futuro
      
      a#skipBtn.btn-skip(href="/lobby") 
        | Saltar Intro ⏭

    script.
      document.addEventListener('DOMContentLoaded', () => {
        const video = document.getElementById('introVideo');
        const audio = document.getElementById('introAudio');
        const btn = document.getElementById('skipBtn');

        // 1. Asegurar que el video inicie (Muted es garantía de éxito)
        video.play().catch(e => console.log("Video bloqueado:", e));

        // 2. Intentar arrancar el audio
        const playAudio = () => {
          audio.play().then(() => {
            // Si el audio arranca, quitamos los listeners para no repetir
            document.removeEventListener('click', playAudio);
            document.removeEventListener('keydown', playAudio);
          }).catch(err => {
            console.log("Esperando interacción para el audio...");
          });
        };

        // Escuchar CUALQUIER interacción para disparar el sonido
        document.addEventListener('click', playAudio);
        document.addEventListener('keydown', playAudio);

        // 3. Transición al Lobby
        function irAlLobby() {
          document.body.classList.add('fade-out');
          setTimeout(() => {
            localStorage.setItem('inymo_intro_seen', 'true');
            window.location.href = '/lobby';
          }, 1000); 
        }

        video.onended = () => irAlLobby();
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          irAlLobby();
        });

        setTimeout(() => { btn.style.opacity = '1'; }, 3000);
      });